# 葫芦瓜 gourd

## 初衷
- Gourd是消息中间件（kafka、RocketMQ等）的扩展应用
- Gourd是一种“平台消息总线”的设计和实现方案
- Gourd软件瓜系列SOA服务治理平台组件中最核心的组件，没有之一
- Gourd希望能传达一些消息中间件使用的规范做法，和高级应用扩展思路

## V1.0介绍
&nbsp;&nbsp;&nbsp;&nbsp;微服务架构开发过程中，应用间交互大体分为同步接口和异步事件驱动两类。以基于Spring cloud体系作为微服务支撑框架的平台开发为例，同步接口调用又大体分HTTP请求和接口声明式(Feign)两类，事件驱动则是采用消息中间件作为媒介以生产者消费者模式进行应用交互。
* __接口交互__：同步接口调用
    * HTTP （RestTemplate）
    * 声明式接口（Feign）
* __事件交互__：事件驱动的异步触发与应答交互
    * Kafka
    * RocketMQ
    * RabbitMQ
    * ActiveMQ

&nbsp;&nbsp;&nbsp;&nbsp;使用同步接口还是事件驱动不是本项目重点，不做展开分析。本分主要介绍事件驱动的常见场景和建议方案，以便于能快速理解Gourd的设计思想和适用场景。

&nbsp;&nbsp;&nbsp;&nbsp;当有人问起“是使用kafka还是rocketMQ更好？”，我们先pending两者的比较这件事，先梳理一下当前需要应用消息中间件的场景，大体应该如下图：
![image](https://note.youdao.com/yws/public/resource/538d2242bcce3308d54eaa7e04785d04/xmlnote/BD5BCB3E789B4108A3753CBA5E85E0B7/5601)

从场景需求触发，如果要保证当前请求的 __“业务事物性”__ 又要避免系统间耦合,那么放弃接口交互而使用事件交互，消息中间件则需要支持 __事务性消息__ ；如果不需要保证“业务事务性”，如在主要调用链路上基础上的分支链路（通知，数据归集等），则基于吞吐量和成本等角度选择消息中间件即可。

&nbsp;&nbsp;&nbsp;&nbsp;然而事情并不是如此简单，一个平台的各个应用，基于上述的选型原则与平台的不断壮大，最终会出现各种“即又”，即用kafka又用RocketMQ，再掺杂一些来不及重构的旧接口和非java语言系统的服务，此时，为了避免重复造轮子和更具 __“架构兼容性”__ 我们建议对消息中间件进行封装，形成可配置化组件如图：
![image](https://note.youdao.com/yws/public/resource/538d2242bcce3308d54eaa7e04785d04/xmlnote/108BC234A70944E2A45405F0F7F2078F/5619)

更多细节暂不展开，见后续详细设计文档， __葫芦瓜__ 的第一个版本 __V1.0__ 也将初步实现当前方案。 

&nbsp;&nbsp;&nbsp;&nbsp;事实上藉由当前方案，仍能引导出更多待解决问题和可持续扩展的通用场景，预计在__葫芦瓜__ 的后续版本中，逐渐展开并一一实现。


V1.0 发布报告请进：

## 关键字
* __业务事务性__  基于数据库事物的概念，来描述微服务架构调用链路的执行范围，基于业务闭环要求和架构设计的最小知识原则，  例如一个前端请求从发起，到后台各个协作服务依次“同步处理”结束（或异常终止）并且最终明确的返回信息给请求发起方。

* __架构兼容性__ 架构兼容性是指，在服务治理过程中，往往即要背负“历史债”，又要面对新的业务需求，所以设计方面，最好能照顾到数据处理上能承上启下，系统交互上能合纵连横，友好的融入当前复杂的体系，并且能为当前平台有选择性局部升级，提供过渡支撑。

